<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cmcc.paymentclean.mapper.PcacRiskInfoMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.cmcc.paymentclean.entity.PcacRiskInfo">
        <id column="pcac_risk_info_id" property="pcacRiskInfoId" />
        <result column="push_list_type" property="pushListType" />
        <result column="up_date" property="upDate" />
        <result column="reg_name" property="regName" />
        <result column="cus_name" property="cusName" />
        <result column="doc_type" property="docType" />
        <result column="doc_code" property="docCode" />
        <result column="leg_doc_name" property="legDocName" />
        <result column="leg_doc_type" property="legDocType" />
        <result column="leg_doc_code" property="legDocCode" />
        <result column="level" property="level" />
        <result column="risk_type" property="riskType" />
        <result column="valid_date" property="validDate" />
        <result column="valid_status" property="validStatus" />
        <result column="cus_type" property="cusType" />
        <result column="occurarea" property="occurarea" />
        <result column="bank_no" property="bankNo" />
        <result column="url" property="url" />
        <result column="registered_code" property="registeredCode" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        pcac_risk_info_id,push_list_type, up_date, reg_name, cus_name, doc_type, doc_code, leg_doc_name, leg_doc_type, leg_doc_code, level, risk_type, valid_date, valid_status, cus_type, occurarea, bank_no, url, registered_code
    </sql>

    <select id="pagePcacRiskInfo" resultType="com.cmcc.paymentclean.entity.dto.response.PcacRiskInfoResp"
            parameterType="com.cmcc.paymentclean.entity.dto.resquest.PcacRiskInfoReq">
        SELECT
        <include refid="Base_Column_List"/>
        FROM
        pcac_risk_info t
        WHERE
        1=1
        <if test="req.regName !=null and req.regName !=''">
            and t.reg_Name like concat('%',#{req.regName},'%')
        </if>
        <if test="req.legDocCode !=null and req.legDocCode !=''">
            and t.leg_Doc_Code=#{req.legDocCode}
        </if>
        <if test="req.docCode !=null and req.docCode !=''">
            and t.doc_Code=#{req.docCode}
        </if>
        <if test="req.docType !=null and req.docType !=''">
            and t.doc_Type=#{req.docType}
        </if>
        <if test="req.legDocType !=null and req.legDocType !=''">
            and t.leg_Doc_Type=#{req.legDocType}
        </if>
        <if test="req.pushStartTime!=null ">
            <!--<![CDATA[  and DATE_FORMAT(t.up_date, '%Y-%m-%d') >= DATE_FORMAT(#{req.pushStartTime}, '%Y-%m-%d')   -->
            <![CDATA[ AND  STR_TO_DATE(t.up_date,'%Y-%m-%d') >= #{req.pushStartTime} ]]>
        </if>
        <if test="req.pushEndTime!=null ">
            <!--<![CDATA[  and DATE_FORMAT(t.up_date, '%Y-%m-%d') <= DATE_FORMAT(#{req.pushEndTime}, '%Y-%m-%d')    ]]>-->
            <![CDATA[ AND #{req.pushEndTime} >= STR_TO_DATE(t.up_date,'%Y-%m-%d')]]>
        </if>
    </select>

    <insert id="insertBatchPcacRiskInfo" parameterType="com.cmcc.paymentclean.entity.PcacRiskInfo">

        insert into  pcac_risk_info ( push_list_type, up_date, reg_name, cus_name, doc_type, doc_code, leg_doc_name, leg_doc_type, leg_doc_code, level, risk_type,
        valid_date, valid_status, cus_type, occurarea, bank_no, url, registered_code)  values
        <foreach collection="items" item="item" separator=",">
            (#{item.push_list_type},#{item.up_date},#{item.reg_name},#{item.cus_name},#{item.doc_type},#{item.leg_doc_name},#{item.leg_doc_type}
            ,#{item.leg_doc_code},#{item.level},#{item.risk_type},#{item.valid_date},#{item.valid_status},#{item.cus_type},#{item.occurarea},#{item.bank_no},#{item.url},#{item.registered_code})
        </foreach>
    </insert>

</mapper>
